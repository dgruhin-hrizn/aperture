# =============================================================================
# Aperture Configuration
# =============================================================================
# Copy this file to .env.local and fill in your values
# NEVER commit .env.local to version control

# -----------------------------------------------------------------------------
# Core
# -----------------------------------------------------------------------------
PORT=3456
NODE_ENV=development
SESSION_SECRET=change-me-to-a-random-string-at-least-32-chars
APP_BASE_URL=http://localhost:3456

# -----------------------------------------------------------------------------
# Database
# -----------------------------------------------------------------------------
# For Docker deployment: postgres://app:app@db:5432/aperture
# For local dev with Docker DB: postgres://app:app@localhost:5432/aperture
DATABASE_URL=postgres://app:app@db:5432/aperture

# -----------------------------------------------------------------------------
# OpenAI
# -----------------------------------------------------------------------------
OPENAI_API_KEY=
OPENAI_EMBED_MODEL=text-embedding-3-small

# -----------------------------------------------------------------------------
# Media Server
# -----------------------------------------------------------------------------
# Type: 'emby' or 'jellyfin'
MEDIA_SERVER_TYPE=emby
MEDIA_SERVER_BASE_URL=http://yourserver:8096
MEDIA_SERVER_API_KEY=

# Path mapping for absolute paths in STRM files (used when STRM_USE_STREAMING_URL=false)
# This is the root path on your media server where media files are located
MEDIA_SERVER_LIBRARY_ROOT=/mnt/media

# -----------------------------------------------------------------------------
# STRM / Virtual Library Config
# -----------------------------------------------------------------------------
# Aperture creates virtual libraries with STRM files for each user's recommendations.
# These files must be accessible by both Aperture (to write) and your media server (to read).
#
# === SETUP OPTIONS ===
#
# Option 1: Same machine (Aperture and media server on same host)
#   MEDIA_SERVER_STRM_ROOT=/path/to/strm
#   AI_LIBRARY_PATH_PREFIX=/path/to/strm/aperture/
#
# Option 2: Network share (Aperture and media server on different machines)
#   1. Create a shared folder accessible by both machines
#   2. Mount the share on the machine running Aperture
#   3. Add the share as a volume mount in your media server's Docker container
#
#   Example:
#   - Shared folder: /mnt/user/Media/VirtualLibraries (on NAS/server)
#   - Aperture mount: /Volumes/Media/VirtualLibraries (on Mac) or /mnt/share (on Linux)
#   - Media server container mount: /VirtualLibraries
#
#   MEDIA_SERVER_STRM_ROOT=/Volumes/Media/VirtualLibraries  # Where Aperture writes
#   AI_LIBRARY_PATH_PREFIX=/VirtualLibraries/aperture/      # What media server sees

# Where Aperture writes STRM files (local/mounted path)
MEDIA_SERVER_STRM_ROOT=/strm

# Where the media server sees STRM files (path inside its container or on its host)
AI_LIBRARY_PATH_PREFIX=/strm/aperture/

# Library name prefix for user libraries (e.g., "AI Picks - Username")
AI_LIBRARY_NAME_PREFIX=AI Picks - 

# Use streaming URLs in STRM files instead of direct file paths
# Recommended for network setups where media server may not have direct file access
# true = STRM contains: http://server:port/Videos/ItemId/stream?api_key=KEY
# false = STRM contains: /path/to/actual/movie.mkv
STRM_USE_STREAMING_URL=true

# -----------------------------------------------------------------------------
# Background Jobs (cron expressions)
# -----------------------------------------------------------------------------
# Movie sync: daily at 3 AM
SYNC_CRON=0 3 * * *

# Recommendations: daily at 4 AM
RECS_CRON=0 4 * * *

# Permission sync: daily at 5 AM
PERMS_CRON=0 5 * * *

# -----------------------------------------------------------------------------
# Runtime
# -----------------------------------------------------------------------------
# Run database migrations automatically on server start
RUN_MIGRATIONS_ON_START=true
