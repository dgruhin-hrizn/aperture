# Aperture v0.5.8 Release Notes

Hey everyone! ğŸ‘‹

This release brings powerful new filtering capabilities to Discovery and fixes a critical bug that affected users switching between embedding models.

---

## âœ¨ New Feature: Advanced Discovery Filters

The Discovery page now includes a comprehensive filtering panel that gives you fine-grained control over what content appears in your recommendations:

### Filter Options

- **Language Filter** â€” Filter by original language (English, Korean, Japanese, Spanish, etc.) using ISO 639-1 language codes
- **Genre Filter** â€” Select specific genres to focus your discovery
- **Year Range Slider** â€” Set minimum and maximum release year to narrow down results
- **Minimum Similarity Score** â€” Adjust the similarity threshold (0-1) to control how closely matches align with your taste

### Real-Time Library Exclusion

Discovery now intelligently excludes:
- âœ… Content already in your media server library
- âœ… Movies/series you've already watched

This means you'll only see genuinely new content to discover â€” no more "I already have this!" moments.

### Technical Details

- Added `original_language` column to discovery candidates with indexing
- Original language is now extracted from TMDb API during enrichment
- Filtering happens at query time using efficient LEFT JOINs

---

## âœ¨ New Feature: Full Reset Jobs

Two new **manual-only** jobs for completely rebuilding recommendations from scratch:

| Job | Description |
|-----|-------------|
| `full-reset-movie-recommendations` | Delete ALL movie recommendations, then rebuild |
| `full-reset-series-recommendations` | Delete ALL series recommendations, then rebuild |

### When to Use

These destructive jobs are useful after:
- Major algorithm changes
- Switching embedding models
- Recommendations appearing corrupted
- Significant library changes

### Manual-Only UI

Manual-only jobs now display a warning banner in the Jobs configuration dialog explaining their destructive nature. Scheduling controls are disabled â€” these jobs can only be triggered manually.

> âš ï¸ **Warning**: These jobs delete ALL existing recommendations before rebuilding. Users will have no recommendations until the job completes.

---

## ğŸ› Fixed: Embedding Model Dimension Mismatch

### The Problem

When switching between embedding models with different dimensions (e.g., from a 4096-dimension model to a 1024-dimension model), users would encounter this error when generating recommendations:

```
different halfvec dimensions 4096 and 1024
```

This occurred because the stored taste profile had embeddings from the old model, but the system was trying to compare them against the new model's embedding table.

### The Fix

The system now automatically detects when the embedding model has changed and rebuilds the taste profile with the correct dimensions:

- âœ… `getUserTasteProfile` validates that the stored profile's model matches the active model
- âœ… Profiles missing model info (older profiles) are automatically rebuilt
- âœ… Both movie and series recommendation pipelines now store the embedding model ID

**This fix applies to both Movies and Series recommendations.**

---

## ğŸ”§ Other Fixes

- **Fixed resolutions endpoint** â€” Resolved an issue with the video resolutions API endpoint

---

## ğŸš€ Update Instructions

### For Docker Users

```bash
# Pull the latest image
docker compose pull

# Restart with new version
docker compose up -d
```

The new database migration for `original_language` will be applied automatically on startup.

---

## ğŸ“‹ Full Changelog

**New Features:**
- `feat(discovery): add advanced filtering and real-time library exclusion`
- `feat: add full reset jobs for movies and series recommendations`

**Bug Fixes:**
- `fix: prevent halfvec dimension mismatch when embedding model changes`
- `fix: resolutions endpoint`

---

## Migration Notes

If you've previously switched embedding models and encountered dimension mismatch errors, your taste profiles will automatically rebuild on the next recommendation generation. No manual action required!
