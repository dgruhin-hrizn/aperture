# Aperture v0.4.7 Release Notes

Hey everyone! üëã

This release focuses on dashboard improvements and bug fixes to make your home screen more useful.

---

## ‚ú® New Features

### Two-Column Recently Watched

The Recently Watched card on the dashboard now displays **Movies** and **Series** in separate columns, making better use of the available space.

- **Movies column** (left): Shows your recently watched movies with play count
- **Series column** (right): Shows recently watched series with the last episode watched (e.g., S2E5)

### Improved Time Display

- **Recently Watched**: Now shows months and years for older items (e.g., "2mo 15d ago", "1y 3mo ago")
- **Recent Ratings**: Displays "Rated on Jan 11, 2026" format instead of relative time

---

## üêõ Bug Fixes

### Metadata Sync Fix

Fixed an issue where **posters and metadata wouldn't update** for movies/series that already existed in your library.

**The problem:** When syncing from Emby/Jellyfin, if a movie existed by title+year but had a different internal ID (common with STRM libraries), the metadata update was silently skipped.

**The fix:** The sync jobs now properly update metadata for items matched by title+year, ensuring poster fixes and other changes in your media server are reflected in Aperture.

### Recently Watched Sorting

Fixed movies appearing in wrong order in Recently Watched. The issue was caused by NULL timestamps being sorted incorrectly.

### Rating Timestamps

Fixed an issue where **all ratings showed today's date** after a Trakt sync.

**The problem:** A database trigger was overwriting `updated_at` on every sync, even when ratings hadn't changed. Additionally, the Trakt sync was unconditionally updating timestamps.

**The fix:**

- Removed the interfering database trigger (via migration)
- Trakt sync now only updates timestamps when the rating value actually changes
- Migration automatically resets corrupted timestamps for existing users

### AI Explanation Batch Size

The recommender now adapts explanation generation based on your AI provider's context window:

| Provider | Batch Size | Max Tokens |
| -------- | ---------- | ---------- |
| **Cloud** (OpenAI, Anthropic, Google) | 10 items | 3,000 |
| **Ollama** (local LLMs) | 5 items | 1,500 |

This prevents context overflow errors on local models with smaller context windows while maximizing throughput on cloud providers.

### Lint Fixes

- Fixed React Hook dependency warning in `RunningJobsWidget`
- Removed unused import in jobs routes

---

## üé® UI Improvements

### Renamed Library Build Jobs

The STRM/symlink library creation jobs now have clearer names:

| Old Name              | New Name                            |
| --------------------- | ----------------------------------- |
| Sync Movie Libraries  | **Build Aperture Movie Libraries**  |
| Sync Series Libraries | **Build Aperture Series Libraries** |

This better reflects what these jobs do ‚Äî they _build_ the AI recommendation libraries in your media server.

---

## üöÄ Update Instructions

### For Existing Docker Users

```bash
# Pull the latest image
docker compose pull

# Restart with new version
docker compose up -d
```

### For New Docker Users

```bash
# Pull the latest image
docker pull ghcr.io/your-org/aperture:latest

# Or use docker compose
docker compose up -d
```

The `:latest` tag always points to the most recent stable release.

---

## üìã Full Changelog

- `feat: split Recently Watched into Movies and Series columns`
- `feat(recommender): adapt explanation batch size based on AI provider`
- `fix: remove user_ratings updated_at trigger that interfered with Trakt sync`
- `fix: dashboard improvements for ratings and recently watched`
- `fix: display rating date as 'Rated on Month Day, Year' format`
- `fix: correct recently watched sorting and improve date display`
- `fix(sync): update metadata for movies/series matched by title+year`
- `style(jobs): rename library sync jobs to 'Build Aperture Libraries'`
- `fix(lint): add missing useEffect dependency in RunningJobsWidget`
- `fix(lint): remove unused subscribeToAllJobs import`

---

Enjoy the improvements! üçø
