# Aperture v0.6.1 Release Notes

Hey everyone! üëã

This release brings **expanded Top Picks sources**, **TMDB integration for popularity rankings**, **language filtering**, **auto-request support for Jellyseerr**, and several important bug fixes.

---

## üéØ Top Picks: Multi-Source Popularity

Top Picks now supports **multiple popularity sources** beyond just local watch history and MDBList. You can now choose from:

### New Popularity Sources

| Source | Description |
|--------|-------------|
| **Local Watch History** | Based on what your users are watching (renamed from "Local") |
| **TMDB Popular** | Most popular movies/series on TMDB |
| **TMDB Trending (Today)** | What's trending today on TMDB |
| **TMDB Trending (Week)** | What's trending this week on TMDB |
| **TMDB Top Rated** | Highest rated content on TMDB |
| **MDBList** | Custom curated list from MDBList |
| **Hybrid** | Blend local watch history with any external source |

### Hybrid Mode Improvements

Hybrid mode now lets you choose **which external source** to blend with your local watch history:

- TMDB Popular
- TMDB Trending (Today/Week)
- TMDB Top Rated
- MDBList

This gives you fine-grained control over how your Top Picks are curated.

### Preview Modal

A new **preview modal** lets you see exactly what items would be included in your Top Picks before saving:

- View matched items (already in your library)
- See which items are missing
- Test different source configurations

---

## üåç Language Filtering for Top Picks

Filter Top Picks results by **original language**:

- **Multi-select language filter** - choose which languages to include (e.g., English, Spanish, Korean)
- **Include unknown languages** option - toggle whether to include content without language metadata
- **Separate settings** for movies and series
- **Dynamic filtering** in preview modal - filter results on-the-fly to see counts
- **Applied everywhere** - filters work for popularity lists, preview, and auto-requests

This is especially useful when using TMDB sources, which may include content from many countries.

---

## üì∫ Series Season Selection for Requests

When requesting missing series through Jellyseerr, you now get **season-level control**:

- **Season selector modal** opens when requesting a series
- **Choose specific seasons** to request instead of the entire series
- **View season details** including episode counts and air dates
- **Integrated with preview modal** - request seasons directly from Top Picks preview

---

## ü§ñ Auto-Request Missing Top Picks

**New Jellyseerr integration for Top Picks!**

When enabled, Aperture can automatically request missing Top Picks items through Jellyseerr:

### Configuration

- **Enable/disable** auto-requests separately for movies and series
- **Set limits** on how many items to request per job run (default: 10)
- **Custom schedule** via cron expression (default: weekly on Sundays)

### How It Works

1. Top Picks job identifies popular content not in your library
2. Auto-request job checks which items are missing
3. Requests are submitted to Jellyseerr automatically
4. Your library grows with trending content your users want

---

## üêõ Bug Fixes

### Fixed: Setup Wizard Not Displaying

The setup wizard wasn't appearing for new installs or when admins tried to re-run it. This was caused by OpenAPI response schemas not matching the actual API responses, causing Fastify to strip required fields.

### Fixed: Poster Images Not Loading

Poster images on the Browse page and movie/series detail pages weren't loading. The response schemas used camelCase property names (`posterUrl`) while the API returned snake_case (`poster_url`), causing the fields to be filtered out.

### Fixed: Custom Model Creation

Adding custom AI models (for Ollama, OpenAI-compatible, OpenRouter, or HuggingFace) failed with "Bad Request" error. The API schema validation used incorrect enum values for the `function` field.

### Fixed: Top Picks Preview

The Top Picks preview modal wasn't showing results for external sources like TMDB Popular, and the "Missing" tab was disabled. Completely rewrote the preview functionality to properly fetch and display both matched and missing items.

### Fixed: Various API Response Issues

Multiple endpoints were returning empty objects or missing fields due to schema mismatches:
- Backup list/create/restore endpoints
- Media server configuration
- Library settings
- Job scheduler status
- Trakt configuration

---

## üöÄ Update Instructions

### For Docker Users

```bash
# Pull the latest image
docker compose pull

# Restart with new version
docker compose up -d
```

Database migrations will be applied automatically on startup.

---

## üìã Full Changelog

**New Features:**
- `feat(top-picks): add TMDB popularity sources (popular, trending, top rated)`
- `feat(top-picks): expanded hybrid mode with selectable external sources`
- `feat(top-picks): add preview modal for testing source configurations`
- `feat(top-picks): add auto-request integration with Jellyseerr`
- `feat(top-picks): add language filters for movies and series`
- `feat(top-picks): add series season selection for Jellyseerr requests`

**Bug Fixes:**
- `fix: setup wizard not displaying for new installs`
- `fix: poster images not loading on browse and detail pages`
- `fix: custom AI model creation failing with Bad Request`
- `fix: top picks preview not showing external source results`
- `fix: various API endpoints returning empty responses`

**Database Migrations:**
- `0099_top_picks_multi_source.sql` ‚Äî Adds new popularity source columns and auto-request settings
- `0100_top_picks_language_filter.sql` ‚Äî Adds language filter columns for movies and series

---

## Migration Notes

### Top Picks Configuration

Existing configurations are automatically migrated:
- `local` source is renamed to `emby_history`
- `hybrid_mdblist_weight` is renamed to `hybrid_external_weight`
- New columns default to sensible values (TMDB Popular for hybrid external source)
- Language filters default to empty (all languages included)

### Auto-Request

Auto-request is **disabled by default**. To enable:
1. Navigate to **Settings ‚Üí Top Picks**
2. Enable auto-request for movies and/or series
3. Configure request limits
4. Ensure Jellyseerr is configured in **Settings ‚Üí Integrations**
