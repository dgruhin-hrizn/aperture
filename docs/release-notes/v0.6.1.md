# Aperture v0.6.1 Release Notes

Hey everyone! üëã

This release brings **expanded Top Picks sources**, **TMDB integration for popularity rankings**, **auto-request support for Jellyseerr**, and several important bug fixes.

---

## üéØ Top Picks: Multi-Source Popularity

Top Picks now supports **multiple popularity sources** beyond just local watch history and MDBList. You can now choose from:

### New Popularity Sources

| Source | Description |
|--------|-------------|
| **Local Watch History** | Based on what your users are watching (renamed from "Local") |
| **TMDB Popular** | Most popular movies/series on TMDB |
| **TMDB Trending (Today)** | What's trending today on TMDB |
| **TMDB Trending (Week)** | What's trending this week on TMDB |
| **TMDB Top Rated** | Highest rated content on TMDB |
| **MDBList** | Custom curated list from MDBList |
| **Hybrid** | Blend local watch history with any external source |

### Hybrid Mode Improvements

Hybrid mode now lets you choose **which external source** to blend with your local watch history:

- TMDB Popular
- TMDB Trending (Today/Week)
- TMDB Top Rated
- MDBList

This gives you fine-grained control over how your Top Picks are curated.

### Preview Modal

A new **preview modal** lets you see exactly what items would be included in your Top Picks before saving:

- View matched items (already in your library)
- See which items are missing
- Test different source configurations

---

## ü§ñ Auto-Request Missing Top Picks

**New Jellyseerr integration for Top Picks!**

When enabled, Aperture can automatically request missing Top Picks items through Jellyseerr:

### Configuration

- **Enable/disable** auto-requests separately for movies and series
- **Set limits** on how many items to request per job run (default: 10)
- **Custom schedule** via cron expression (default: weekly on Sundays)

### How It Works

1. Top Picks job identifies popular content not in your library
2. Auto-request job checks which items are missing
3. Requests are submitted to Jellyseerr automatically
4. Your library grows with trending content your users want

---

## üêõ Fixed: Custom Model Creation

### The Problem

Adding custom AI models (for Ollama, OpenAI-compatible, OpenRouter, or HuggingFace) failed with "Bad Request" error, even when the connection test succeeded.

### The Cause

The API schema validation used incorrect enum values for the `function` field:
- Schema expected: `embedding`, `text_generation`, `chat_assistant`
- Frontend sent: `embeddings`, `chat`, `textGeneration`, `exploration`

### The Fix

Updated the schema enum values to match the actual `AIFunction` type used throughout the application.

---

## üêõ Fixed: Top Picks Preview Now Fully Functional

### The Problem

The Top Picks preview modal wasn't working properly - switching to external sources like TMDB Popular showed no results, and the "Missing" tab was disabled.

### The Cause

The preview API was only returning items that matched your library. For external sources like TMDB, it needed to fetch the full list and show both what you have AND what's missing.

### The Fix

Completely rewrote the preview functionality:

- **New preview functions** that fetch the full external list (TMDB Popular, Trending, Top Rated, or MDBList)
- **Cross-references against your library** to show matched vs missing items
- **Missing tab now works** - shows items from the source that aren't in your library
- **Jellyseerr integration** - request missing items directly from the preview modal

---

## üöÄ Update Instructions

### For Docker Users

```bash
# Pull the latest image
docker compose pull

# Restart with new version
docker compose up -d
```

Database migrations will be applied automatically on startup.

---

## üìã Full Changelog

**New Features:**
- `feat(top-picks): add TMDB popularity sources (popular, trending, top rated)`
- `feat(top-picks): expanded hybrid mode with selectable external sources`
- `feat(top-picks): add preview modal for testing source configurations`
- `feat(top-picks): add auto-request integration with Jellyseerr`

**Bug Fixes:**
- `fix(schemas): correct function enum values for custom AI model creation`

**Database Migrations:**
- `0099_top_picks_multi_source.sql` ‚Äî Adds new popularity source columns and auto-request settings

---

## Migration Notes

### Top Picks Configuration

Existing configurations are automatically migrated:
- `local` source is renamed to `emby_history`
- `hybrid_mdblist_weight` is renamed to `hybrid_external_weight`
- New columns default to sensible values (TMDB Popular for hybrid external source)

### Auto-Request

Auto-request is **disabled by default**. To enable:
1. Navigate to **Settings ‚Üí Top Picks**
2. Enable auto-request for movies and/or series
3. Configure request limits
4. Ensure Jellyseerr is configured in **Settings ‚Üí Integrations**
