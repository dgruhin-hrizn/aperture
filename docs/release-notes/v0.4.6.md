# Aperture v0.4.6 Release Notes

Hey everyone! ğŸ‘‹

This release introduces the **Discovery** feature â€” AI-powered suggestions for content **not in your library** â€” plus full **Jellyseerr integration** for requesting missing content. If you've ever wanted Aperture to help you find your next favorite movie or series that you don't already own, this update is for you!

---

## ğŸ”­ Discovery Feature

### What It Does

Discovery analyzes your watch history and ratings, then suggests movies and TV series you might love but don't have in your library yet. It pulls candidates from multiple sources and ranks them using AI scoring.

### Candidate Sources

**TMDb:**
- **Recommendations** â€” Based on content you've watched recently
- **Similar Titles** â€” Based on content you've rated highly
- **Discover** â€” Popular/trending content meeting quality thresholds

**Trakt:**
- **Trending** â€” Currently hot content
- **Popular** â€” All-time popular content
- **Recommendations** â€” Personalized Trakt picks (if user has linked Trakt account)

### AI Scoring

Each candidate is scored with weighted factors:

- **Similarity Score** (50%) â€” How well it matches your taste profile
- **Popularity Score** (30%) â€” General audience popularity
- **Recency Score** (20%) â€” Bonus for newer releases

Final results are ranked and cached per user.

### Discovery Page

Navigate to **Discovery** from the sidebar to see your personalized suggestions:

- **Movie/Series tabs** â€” Switch between content types
- **Ranked cards** â€” Gold/silver/bronze badges for top 3
- **Source badges** â€” See where each suggestion came from
- **Match percentage** â€” AI confidence in the recommendation
- **Manual refresh** â€” Regenerate suggestions on demand

### Detail Popper

Click the info icon on any card to see:

- **Fanart backdrop** â€” Beautiful full-width backdrop image
- **Full metadata** â€” Year, runtime, rating, vote count
- **Cast & Crew** â€” Top 8 cast members with photos, clickable links to person pages
- **Director/Creator** â€” Clickable links to director pages
- **Score breakdown** â€” AI match and similarity scores
- **Original title** â€” For international content

---

## ğŸ¬ Jellyseerr Integration

### Request Missing Content

Found something in Discovery you want? Request it directly from Aperture!

### Configuration

Navigate to **Admin â†’ Settings â†’ Integrations** to configure:

1. **Jellyseerr URL** â€” Your Jellyseerr instance URL
2. **API Key** â€” Get from Jellyseerr â†’ Settings â†’ General
3. **Enable toggle** â€” Turn request capability on/off

### User Permissions

Control who can request content in **Admin â†’ Users**:

- **Discovery Enabled** â€” User can see Discovery suggestions
- **Request Enabled** â€” User can submit requests to Jellyseerr

If Discovery is disabled for a user, requests are automatically disabled too.

### Request Status

- **Pending** â€” Request submitted, awaiting approval
- **Approved** â€” Admin approved the request
- **Declined** â€” Admin declined the request
- **Available** â€” Content has been downloaded and is ready

Request status is shown on Discovery cards with visual badges.

---

## ğŸ“… Discovery Background Job

### generate-discovery-suggestions

A new daily job generates discovery suggestions for all enabled users:

- **Default schedule:** Daily at 6:00 AM
- **Per-user generation** â€” Each user gets personalized results
- **Statistics tracking** â€” Candidates fetched, filtered, scored, stored
- **Run history** â€” Track when suggestions were last updated

### Prerequisites Check

The job shows a warning if prerequisites aren't met:

1. Jellyseerr must be configured (for request functionality)
2. At least one user must have Discovery enabled

---

## ğŸ”“ Passwordless Login

### For Media Servers Without Passwords

Some Emby/Jellyfin servers don't require passwords. Aperture now supports this:

### Configuration

Enable in **Admin â†’ Settings â†’ Media Server â†’ Security Settings** or during initial setup wizard:

- Toggle **"Allow passwordless login"**
- Users can then log in with just their username

### Login Page Behavior

- Password field shows "(optional)" when passwordless is enabled
- Helper text explains the configuration
- Submit button enabled with just username

---

## ğŸ‘¥ Enhanced User Management

### New User Permissions

Two new toggles on the Users page:

- **Discovery** (ğŸ”­) â€” Enable/disable Discovery suggestions
- **Requests** (ğŸ“¤) â€” Enable/disable Jellyseerr requests

### User Detail Page

The individual user settings page now includes:

- Discovery toggle with description
- Request toggle with description (only shown when Discovery is enabled)

---

## ğŸ¨ UI Improvements

### RankBadge Component

Enhanced rank badges for Discovery and other ranked lists:

- **Top 3 medals** â€” Gold (#1), Silver (#2), Bronze (#3)
- **Numbered badges** â€” 4-50 with dark background
- **Size variants** â€” Small, medium, large

### Discovery Cards

Beautiful card design with:

- Poster image with fallback
- Rank badge (top-left)
- Source chip (top-right)
- Match percentage (bottom-right)
- Request status badge (bottom-left when applicable)
- Hover overlay with request button

---

## ğŸ”§ Technical Details

### New Database Tables

**discovery_runs** â€” Track job executions per user
- Run statistics (fetched, filtered, scored, stored)
- Duration tracking
- Status (running, completed, failed)

**discovery_candidates** â€” Cached recommendations
- Full metadata (title, year, poster, backdrop, genres, etc.)
- Cast & crew info for detail popper
- Score breakdown
- Source tracking

**discovery_requests** â€” Track Jellyseerr submissions
- Request status
- Jellyseerr request/media IDs
- Link to discovery candidate

### New Migrations

- **0080_discovery_feature.sql** â€” Main tables and user columns
- **0081_discovery_imdb_id.sql** â€” IMDb ID for direct linking
- **0082_discovery_cast.sql** â€” Cast/crew metadata columns

### New API Endpoints

**Discovery:**
- `GET /api/discovery/movies` â€” Get movie suggestions
- `GET /api/discovery/series` â€” Get series suggestions
- `POST /api/discovery/refresh/movies` â€” Regenerate movie suggestions
- `POST /api/discovery/refresh/series` â€” Regenerate series suggestions
- `GET /api/discovery/status` â€” Get user's discovery status
- `GET /api/discovery/prerequisites` â€” Check if prerequisites are met

**Jellyseerr:**
- `GET /api/jellyseerr/config` â€” Get configuration
- `PUT /api/jellyseerr/config` â€” Update configuration
- `POST /api/jellyseerr/test` â€” Test connection
- `GET /api/jellyseerr/status/:mediaType/:tmdbId` â€” Get media status
- `POST /api/jellyseerr/status/batch` â€” Batch status check
- `POST /api/jellyseerr/request` â€” Create request
- `GET /api/jellyseerr/requests` â€” Get user's requests

**Auth:**
- `GET /api/auth/login-options` â€” Get passwordless setting

**Settings:**
- `GET /api/settings/media-server/security` â€” Get security settings
- `PATCH /api/settings/media-server/security` â€” Update security settings

### New Core Modules

**@aperture/core/discover:**
- `pipeline.ts` â€” Main discovery generation flow
- `sources.ts` â€” Fetch candidates from TMDb/Trakt
- `filter.ts` â€” Filter out library/watched content
- `scorer.ts` â€” AI scoring algorithm
- `storage.ts` â€” Database operations
- `types.ts` â€” TypeScript interfaces

**@aperture/core/jellyseerr:**
- `provider.ts` â€” Jellyseerr API client
- `types.ts` â€” TypeScript interfaces

---

## ğŸš€ Upgrade Instructions

### For All Users

1. **Update Aperture** â€” Pull the latest version
2. **Run migrations** â€” Automatic on startup (0080, 0081, 0082)
3. **Configure Jellyseerr** â€” Admin â†’ Settings â†’ Integrations (optional but recommended)
4. **Enable Discovery** â€” Admin â†’ Users â†’ Enable for desired users
5. **Run Discovery job** â€” Or wait for daily schedule

### For Jellyseerr Users

1. Get your API key from Jellyseerr â†’ Settings â†’ General
2. Enter URL and API key in Aperture settings
3. Test connection
4. Enable request permissions for users

### For Passwordless Servers

1. Go to Admin â†’ Settings â†’ Media Server
2. Enable "Allow passwordless login" in Security Settings
3. Users can now log in without passwords

---

## ğŸ“‹ Full Changelog

- `feat(discover): add discovery feature for suggesting content not in library`
- `feat(discover): fetch candidates from TMDb recommendations and similar`
- `feat(discover): fetch candidates from TMDb discover API`
- `feat(discover): fetch candidates from Trakt trending and popular`
- `feat(discover): fetch personalized Trakt recommendations for linked users`
- `feat(discover): AI scoring with similarity, popularity, and recency weights`
- `feat(discover): store cast/crew metadata for detail popper`
- `feat(discover): add IMDb ID for direct linking`
- `feat(jellyseerr): add Jellyseerr integration for content requests`
- `feat(jellyseerr): batch status checking for discovery page`
- `feat(jellyseerr): request status tracking (pending, approved, declined, available)`
- `feat(ui): add Discovery page with movie/series tabs`
- `feat(ui): add discovery detail popper with fanart backdrop`
- `feat(ui): add cast/crew section with clickable person links`
- `feat(ui): enhance RankBadge component with medal styles`
- `feat(ui): add discovery permission toggles to Users page`
- `feat(ui): add Jellyseerr configuration section in Settings`
- `feat(jobs): add generate-discovery-suggestions background job`
- `feat(jobs): show prerequisites warning for discovery job`
- `feat(auth): add passwordless login option`
- `feat(settings): add security settings for passwordless login`
- `chore(db): add discovery_runs, discovery_candidates, discovery_requests tables`
- `chore(db): add discover_enabled, discover_request_enabled user columns`

---

## ğŸ”® What's Next

Future enhancements may include:

- MDBList integration as discovery source
- "Because you liked X" context for recommendations
- Discovery filters (genre, year, etc.)
- Request notification preferences
- Overseerr support (in addition to Jellyseerr)

---

Enjoy discovering new content! ğŸ”­ğŸ¿


